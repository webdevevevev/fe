import{d as W,u as X,O as f,K as Y,A as Z,G as x,S as g,L as C,j as ee,r as D,b as c,o as d,m as y,i as l,y as r,c as v,w as t,g as b,k as n,M as N,N as se,e as o,B as te,P as ae,Q as oe,R as ne,F as le,n as ie,J as ce,T as de,V as re,U as ue,D as pe,H as _e,p as be,h as me,_ as fe}from"./index-74fb8591.js";const ye=m=>(be("data-v-e94e3ec4"),m=m(),me(),m),ve={class:"header"},we={class:"title"},ke={class:"spans"},ge={class:"price"},he={class:"time"},Ce={class:"ctime"},Ve={class:"mtime"},$e={class:"expire"},Se={class:"desc"},Ie=["src"],Ae={key:2},Le=ye(()=>l("div",{class:"el-upload__tip"}," 支持上传图片和视频 ",-1)),je={class:"dialog-footer"},Be=W({__name:"Post",props:{base:{}},emits:["publish"],setup(m,{emit:P}){const i=m,U=P,h=X(),V=i.base instanceof f?Y:Z,$=i.base instanceof f?x:g,S=C(()=>i.base.state===g.accepted),w=C(()=>{var e;return((e=i.base.user)==null?void 0:e.id)===h.getters.userId}),p=ee(!1);let u=D(i.base instanceof f?I():i.base);const F=C(()=>w.value||i.base.state!==$.pending);function I(){const e=new ce;return e.userId=h.getters.userId,e.user.id=e.userId,e.offerId=i.base.id,e.offer=new f,e.offer.id=e.offerId,e}function O(){return w.value?z(i.base):M()}function z(e){return p.value=!1,de(e)}async function M(){p.value=!1;const e=await re(u),s=u;u=D(I()),s.id=e,s.user=new ue,s.user.nickname=h.state.nickname,U("publish",s)}async function R(){const e=i.base;await pe(e.id),e.state=g.accepted}async function T(){const e=i.base;await _e(e.id),e.state=g.rejected}return(e,s)=>{var L,j,B;const k=c("el-tooltip"),_=c("el-button"),E=c("el-icon"),G=c("el-button-group"),H=c("el-image"),J=c("el-input"),A=c("el-form-item"),K=c("el-upload"),Q=c("el-form"),q=c("el-dialog");return d(),y("article",null,[l("header",ve,[l("h2",we,r((L=e.base)==null?void 0:L.title),1),l("div",ke,[isFinite(e.base.type)?(d(),v(k,{key:0,content:`类型：${n(N)[e.base.type]}`},{default:t(()=>[b(r(n(N)[e.base.type]),1)]),_:1},8,["content"])):se("",!0),o(k,{content:`状态：${n(V)[e.base.state]}`},{default:t(()=>[l("span",{class:te(["state",n($)[e.base.state]])},r(n(V)[e.base.state]),3)]),_:1},8,["content"]),l("span",ge,r((j=e.base)==null?void 0:j.price)+"元",1)]),e.base instanceof n(f)?(d(),v(_,{key:0,type:"primary",class:"action-btn",disabled:F.value,onClick:s[0]||(s[0]=a=>p.value=!0)},{default:t(()=>[b(" 发布响应 ")]),_:1},8,["disabled"])):w.value?(d(),v(_,{key:1,type:"primary",class:"action-btn",onClick:s[1]||(s[1]=a=>p.value=!0)},{default:t(()=>[b(" 修改响应 ")]),_:1})):(d(),v(G,{key:2,size:"small",onClick:s[2]||(s[2]=ne(()=>{},["stop"])),class:"action-btn"},{default:t(()=>[o(k,{content:"接受"},{default:t(()=>[o(_,{icon:n(ae),onClick:R,disabled:S.value},null,8,["icon","disabled"])]),_:1}),o(k,{content:"拒绝"},{default:t(()=>[o(_,{class:"reject-btn",onClick:T,disabled:S.value},{default:t(()=>[o(E,{color:"red"},{default:t(()=>[o(n(oe))]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1}))]),l("div",he,[l("span",Ce,"发布于"+r(e.base.ctime),1),l("span",Ve,"修改于"+r(e.base.mtime),1),l("p",$e,"过期于"+r((B=e.base)==null?void 0:B.expire),1)]),l("p",Se,r(e.base.desc),1),(d(!0),y(le,null,ie(e.base.files,a=>(d(),y("p",{key:a},[/\.(?:(?:pn|jpe?)g|webp)$/.test(a)?(d(),v(H,{key:0,src:a,alt:a},null,8,["src","alt"])):/\.(?:webm|mp4)$/.test(a)?(d(),y("video",{key:1,src:a,controls:""},null,8,Ie)):(d(),y("span",Ae,r(a),1))]))),128)),o(q,{modelValue:p.value,"onUpdate:modelValue":s[6]||(s[6]=a=>p.value=a),title:`${w.value?"修改":"发布"}响应`},{footer:t(()=>[l("span",je,[o(_,{onClick:s[5]||(s[5]=a=>p.value=!1)},{default:t(()=>[b("取消")]),_:1}),o(_,{type:"primary",onClick:O},{default:t(()=>[b(" 提交 ")]),_:1})])]),default:t(()=>[o(Q,{model:n(u),class:"publish-form","label-width":"80px"},{default:t(()=>[o(A,{label:"描述"},{default:t(()=>[o(J,{modelValue:n(u).desc,"onUpdate:modelValue":s[3]||(s[3]=a=>n(u).desc=a),type:"textarea",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(A,{label:"文件列表"},{default:t(()=>[o(K,{"file-list":n(u).files,"onUpdate:fileList":s[4]||(s[4]=a=>n(u).files=a),class:"upload","auto-upload":!1,multiple:""},{trigger:t(()=>[o(_,{type:"primary"},{default:t(()=>[b("选择文件")]),_:1})]),tip:t(()=>[Le]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const Ne=fe(Be,[["__scopeId","data-v-e94e3ec4"]]);export{Ne as P};
