import{d as X,u as Y,O as m,K as Z,A as x,G as ee,S as g,L as h,j as se,r as B,b as c,o as d,m as y,i as l,y as r,c as v,w as t,g as b,k as n,M as D,N as te,e as o,B as ae,P as oe,Q as ne,R as le,F as ie,n as ce,J as de,T as re,V as ue,U as pe,D as _e,H as be,p as fe,h as me,_ as ye}from"./index-adbc4003.js";const ve=f=>(fe("data-v-c08b527f"),f=f(),me(),f),we={class:"header"},ke={class:"title"},ge={class:"spans"},$e={class:"price"},he={class:"time"},Ce={class:"ctime"},Ve={class:"mtime"},Se={class:"expire"},Ie={class:"desc"},Ae=["src"],Le={key:2},je=ve(()=>l("div",{class:"el-upload__tip"}," 支持上传图片和视频 ",-1)),Pe={class:"dialog-footer"},N="/uploads",Be=X({__name:"Post",props:{base:{}},emits:["publish"],setup(f,{emit:U}){const i=f,F=U,$=Y(),C=i.base instanceof m?Z:x,V=i.base instanceof m?ee:g,S=h(()=>i.base.state===g.accepted),w=h(()=>{var e;return((e=i.base.user)==null?void 0:e.id)===$.getters.userId}),p=se(!1);let u=B(i.base instanceof m?I():i.base);const O=h(()=>w.value||i.base.state!==V.pending);function I(){const e=new de;return e.userId=$.getters.userId,e.user.id=e.userId,e.offerId=i.base.id,e.offer=new m,e.offer.id=e.offerId,e}function z(){return w.value?M(i.base):R()}function M(e){return p.value=!1,re(e)}async function R(){p.value=!1;const e=await ue(u),s=u;u=B(I()),s.id=e,s.user=new pe,s.user.nickname=$.state.nickname,F("publish",s)}async function T(){const e=i.base;await _e(e.id),e.state=g.accepted}async function E(){const e=i.base;await be(e.id),e.state=g.rejected}return(e,s)=>{var L,j,P;const k=c("el-tooltip"),_=c("el-button"),G=c("el-icon"),H=c("el-button-group"),J=c("el-image"),K=c("el-input"),A=c("el-form-item"),Q=c("el-upload"),q=c("el-form"),W=c("el-dialog");return d(),y("article",null,[l("header",we,[l("h2",ke,r((L=e.base)==null?void 0:L.title),1),l("div",ge,[isFinite(e.base.type)?(d(),v(k,{key:0,content:`类型：${n(D)[e.base.type]}`},{default:t(()=>[b(r(n(D)[e.base.type]),1)]),_:1},8,["content"])):te("",!0),o(k,{content:`状态：${n(C)[e.base.state]}`},{default:t(()=>[l("span",{class:ae(["state",n(V)[e.base.state]])},r(n(C)[e.base.state]),3)]),_:1},8,["content"]),l("span",$e,r((j=e.base)==null?void 0:j.price)+"元",1)]),e.base instanceof n(m)?(d(),v(_,{key:0,type:"primary",class:"action-btn",disabled:O.value,onClick:s[0]||(s[0]=a=>p.value=!0)},{default:t(()=>[b(" 发布响应 ")]),_:1},8,["disabled"])):w.value?(d(),v(_,{key:1,type:"primary",class:"action-btn",onClick:s[1]||(s[1]=a=>p.value=!0)},{default:t(()=>[b(" 修改响应 ")]),_:1})):(d(),v(H,{key:2,size:"small",onClick:s[2]||(s[2]=le(()=>{},["stop"])),class:"action-btn"},{default:t(()=>[o(k,{content:"接受"},{default:t(()=>[o(_,{icon:n(oe),onClick:T,disabled:S.value},null,8,["icon","disabled"])]),_:1}),o(k,{content:"拒绝"},{default:t(()=>[o(_,{class:"reject-btn",onClick:E,disabled:S.value},{default:t(()=>[o(G,{color:"red"},{default:t(()=>[o(n(ne))]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1}))]),l("div",he,[l("span",Ce,"发布于"+r(e.base.ctime),1),l("span",Ve,"修改于"+r(e.base.mtime),1),l("p",Se,"过期于"+r((P=e.base)==null?void 0:P.expire),1)]),l("p",Ie,r(e.base.desc),1),(d(!0),y(ie,null,ce(e.base.files,a=>(d(),y("p",{key:a},[/\.(?:(?:pn|jpe?)g|webp)$/.test(a)?(d(),v(J,{key:0,src:`${N}/${a}`,alt:a},null,8,["src","alt"])):/\.(?:webm|mp4)$/.test(a)?(d(),y("video",{key:1,src:`${N}/${a}`,controls:""},null,8,Ae)):(d(),y("span",Le,r(a),1))]))),128)),o(W,{modelValue:p.value,"onUpdate:modelValue":s[6]||(s[6]=a=>p.value=a),title:`${w.value?"修改":"发布"}响应`},{footer:t(()=>[l("span",Pe,[o(_,{onClick:s[5]||(s[5]=a=>p.value=!1)},{default:t(()=>[b("取消")]),_:1}),o(_,{type:"primary",onClick:z},{default:t(()=>[b(" 提交 ")]),_:1})])]),default:t(()=>[o(q,{model:n(u),class:"publish-form","label-width":"80px"},{default:t(()=>[o(A,{label:"描述"},{default:t(()=>[o(K,{modelValue:n(u).desc,"onUpdate:modelValue":s[3]||(s[3]=a=>n(u).desc=a),type:"textarea",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(A,{label:"文件列表"},{default:t(()=>[o(Q,{"file-list":n(u).files,"onUpdate:fileList":s[4]||(s[4]=a=>n(u).files=a),class:"upload","auto-upload":!1,multiple:""},{trigger:t(()=>[o(_,{type:"primary"},{default:t(()=>[b("选择文件")]),_:1})]),tip:t(()=>[je]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const Ne=ye(Be,[["__scopeId","data-v-c08b527f"]]);export{Ne as P};
