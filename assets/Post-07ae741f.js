import{d as X,u as Y,O as w,J as Z,z as x,D as ee,S as h,K as $,i as se,r as N,b as i,o as c,l as y,h as l,x as d,c as g,w as t,f as b,j as n,L as P,M as te,e as o,A as ae,N as oe,P as ne,Q as le,F as re,m as ie,H as ce,R as de,E as k,T as ue,U as pe,B as _e,G as me,p as be,g as fe,_ as we}from"./index-711f5c83.js";const ye=f=>(be("data-v-bbacf410"),f=f(),fe(),f),ge={class:"header"},ve={class:"title"},he={class:"spans"},ke={class:"price"},Ce={class:"time"},$e={class:"ctime"},Se={class:"mtime"},Ve={class:"expire"},Ie={class:"desc"},Ae=["src"],Le={key:2},je=ye(()=>l("div",{class:"el-upload__tip"}," 支持上传图片和视频 ",-1)),Be={class:"dialog-footer"},De=X({__name:"Post",props:{base:{}},emits:["publish"],setup(f,{emit:U}){const r=f,z=U,C=Y(),S=r.base instanceof w?Z:x,V=r.base instanceof w?ee:h,I=$(()=>r.base.state===h.accepted),v=$(()=>{var e;return((e=r.base.user)==null?void 0:e.id)===C.getters.userId}),p=se(!1);let u=N(r.base instanceof w?A():r.base);const E=$(()=>v.value||r.base.state!==V.pending);function A(){const e=new ce;return e.userId=C.getters.userId,e.user.id=e.userId,e.offerId=r.base.id,e.offer=new w,e.offer.id=e.offerId,e}function F(){return v?M(r.base):O()}function M(e){p.value=!1;try{return de(e)}catch(s){return k.error({showClose:!0,message:s.message}),console.error(s)}}async function O(){p.value=!1;let e;try{e=await ue(u)}catch(_){return k.error({showClose:!0,message:_.message}),console.error(_)}const s=u;u=N(A()),s.id=e,s.user=new pe,s.user.nickname=C.state.nickname,z("publish",s)}async function R(){const e=r.base;try{await _e(e.id)}catch(s){k.error({showClose:!0,message:s.message}),console.error(s)}e.state=h.accepted}async function T(){const e=r.base;try{await me(e.id)}catch(s){k.error({showClose:!0,message:s.message}),console.error(s)}e.state=h.rejected}return(e,s)=>{var j,B,D;const _=i("el-tooltip"),m=i("el-button"),G=i("el-icon"),H=i("el-button-group"),J=i("el-image"),K=i("el-input"),L=i("el-form-item"),Q=i("el-upload"),q=i("el-form"),W=i("el-dialog");return c(),y("article",null,[l("header",ge,[l("h2",ve,d((j=e.base)==null?void 0:j.title),1),l("div",he,[isFinite(e.base.type)?(c(),g(_,{key:0,content:`类型：${n(P)[e.base.type]}`},{default:t(()=>[b(d(n(P)[e.base.type]),1)]),_:1},8,["content"])):te("",!0),o(_,{content:`状态：${n(S)[e.base.state]}`},{default:t(()=>[l("span",{class:ae(["state",n(V)[e.base.state]])},d(n(S)[e.base.state]),3)]),_:1},8,["content"]),l("span",ke,d((B=e.base)==null?void 0:B.price)+"元",1)]),e.base instanceof n(w)?(c(),g(m,{key:0,type:"primary",class:"action-btn",disabled:E.value,onClick:s[0]||(s[0]=a=>p.value=!0)},{default:t(()=>[b(" 发布响应 ")]),_:1},8,["disabled"])):v.value?(c(),g(m,{key:1,type:"primary",class:"action-btn",onClick:s[1]||(s[1]=a=>p.value=!0)},{default:t(()=>[b(" 修改响应 ")]),_:1})):(c(),g(H,{key:2,size:"small",onClick:s[2]||(s[2]=le(()=>{},["stop"])),class:"action-btn"},{default:t(()=>[o(_,{content:"接受"},{default:t(()=>[o(m,{icon:n(oe),onClick:R,disabled:I.value},null,8,["icon","disabled"])]),_:1}),o(_,{content:"拒绝"},{default:t(()=>[o(m,{class:"reject-btn",onClick:T,disabled:I.value},{default:t(()=>[o(G,{color:"red"},{default:t(()=>[o(n(ne))]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1}))]),l("div",Ce,[l("span",$e,"发布于"+d(e.base.ctime),1),l("span",Se,"修改于"+d(e.base.mtime),1),l("p",Ve,"过期于"+d((D=e.base)==null?void 0:D.expire),1)]),l("p",Ie,d(e.base.desc),1),(c(!0),y(re,null,ie(e.base.files,a=>(c(),y("p",{key:a},[/\.(?:(?:pn|jpe?)g|webp)$/.test(a)?(c(),g(J,{key:0,src:a,alt:a},null,8,["src","alt"])):/\.(?:webm|mp4)$/.test(a)?(c(),y("video",{key:1,src:a,controls:""},null,8,Ae)):(c(),y("span",Le,d(a),1))]))),128)),o(W,{modelValue:p.value,"onUpdate:modelValue":s[6]||(s[6]=a=>p.value=a),title:`${v.value?"修改":"发布"}响应`},{footer:t(()=>[l("span",Be,[o(m,{onClick:s[5]||(s[5]=a=>p.value=!1)},{default:t(()=>[b("取消")]),_:1}),o(m,{type:"primary",onClick:F},{default:t(()=>[b(" 提交 ")]),_:1})])]),default:t(()=>[o(q,{model:n(u),class:"publish-form","label-width":"80px"},{default:t(()=>[o(L,{label:"描述"},{default:t(()=>[o(K,{modelValue:n(u).desc,"onUpdate:modelValue":s[3]||(s[3]=a=>n(u).desc=a),type:"textarea",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(L,{label:"文件列表"},{default:t(()=>[o(Q,{"file-list":n(u).files,"onUpdate:fileList":s[4]||(s[4]=a=>n(u).files=a),class:"upload","auto-upload":!1,multiple:""},{trigger:t(()=>[o(m,{type:"primary"},{default:t(()=>[b("选择文件")]),_:1})]),tip:t(()=>[je]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const Pe=we(De,[["__scopeId","data-v-bbacf410"]]);export{Pe as P};
