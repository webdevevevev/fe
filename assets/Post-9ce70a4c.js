import{d as Y,u as Z,O as y,L as x,A as ee,G as se,S as g,M as C,j as te,r as B,b as c,o as d,m as w,i as l,y as r,c as b,w as t,g as f,k as n,N as D,P as N,e as o,B as ae,Q as oe,R as ne,T as le,F as ie,n as de,K as ce,V as re,W as ue,U as pe,D as _e,H as be,p as fe,h as me,_ as ve}from"./index-d6c2bc37.js";const ye=m=>(fe("data-v-bb4e495a"),m=m(),me(),m),we={class:"header"},ke={class:"title"},ge={class:"spans"},$e={class:"price"},he={class:"time"},Ce={class:"ctime"},Ve={class:"mtime"},Se={class:"expire"},Ie={class:"desc"},Ae=["src"],Le={key:2},je=ye(()=>l("div",{class:"el-upload__tip"}," 支持上传图片和视频 ",-1)),Pe={class:"dialog-footer"},U="/uploads",Be=Y({__name:"Post",props:{base:{}},emits:["publish"],setup(m,{emit:F}){const i=m,O=F,$=Z(),V=i.base instanceof y?x:ee,S=i.base instanceof y?se:g,h=C(()=>i.base.state!==g.pending),v=C(()=>{var e;return((e=i.base.user)==null?void 0:e.id)===$.getters.userId}),p=te(!1);let u=B(i.base instanceof y?I():i.base);const z=C(()=>v.value||i.base.state!==S.pending);function I(){const e=new ce;return e.userId=$.getters.userId,e.user.id=e.userId,e.offerId=i.base.id,e.offer=new y,e.offer.id=e.offerId,e}function M(){return v.value?R(i.base):T()}function R(e){return p.value=!1,re(e)}async function T(){p.value=!1;const e=await ue(u),s=u;u=B(I()),s.id=e,s.user=new pe,s.user.nickname=$.state.nickname,O("publish",s)}async function E(){const e=i.base;await _e(e.id),e.state=g.accepted}async function G(){const e=i.base;await be(e.id),e.state=g.rejected}return(e,s)=>{var L,j,P;const k=c("el-tooltip"),_=c("el-button"),H=c("el-icon"),K=c("el-button-group"),Q=c("el-image"),W=c("el-input"),A=c("el-form-item"),q=c("el-upload"),J=c("el-form"),X=c("el-dialog");return d(),w("article",null,[l("header",we,[l("h2",ke,r((L=e.base)==null?void 0:L.title),1),l("div",ge,[isFinite(e.base.type)?(d(),b(k,{key:0,content:`类型：${n(D)[e.base.type]}`},{default:t(()=>[f(r(n(D)[e.base.type]),1)]),_:1},8,["content"])):N("",!0),o(k,{content:`状态：${n(V)[e.base.state]}`},{default:t(()=>[l("span",{class:ae(["state",n(S)[e.base.state]])},r(n(V)[e.base.state]),3)]),_:1},8,["content"]),l("span",$e,r((j=e.base)==null?void 0:j.price)+"元",1)]),e.base instanceof n(y)?(d(),b(_,{key:0,type:"primary",class:"action-btn",disabled:z.value,onClick:s[0]||(s[0]=a=>p.value=!0)},{default:t(()=>[f(" 发布响应 ")]),_:1},8,["disabled"])):v.value?(d(),b(_,{key:1,type:"primary",class:"action-btn",onClick:s[1]||(s[1]=a=>p.value=!0),disabled:h.value},{default:t(()=>[f(" 修改响应 ")]),_:1},8,["disabled"])):(d(),b(K,{key:2,size:"small",onClick:s[2]||(s[2]=le(()=>{},["stop"])),class:"action-btn"},{default:t(()=>[o(k,{content:"接受"},{default:t(()=>[o(_,{icon:n(oe),onClick:E,disabled:h.value},null,8,["icon","disabled"])]),_:1}),o(k,{content:"拒绝"},{default:t(()=>[o(_,{class:"reject-btn",onClick:G,disabled:h.value},{default:t(()=>[o(H,{color:"red"},{default:t(()=>[o(n(ne))]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1}))]),l("div",he,[l("span",Ce,"发布于"+r(e.base.ctime),1),l("span",Ve,"修改于"+r(e.base.mtime),1),l("p",Se,"过期于"+r((P=e.base)==null?void 0:P.expire),1)]),l("p",Ie,r(e.base.desc),1),(d(!0),w(ie,null,de(e.base.files,a=>(d(),w("p",{key:a},[/\.(?:(?:pn|jpe?)g|webp)$/.test(a)?(d(),b(Q,{key:0,src:`${U}/${a}`,alt:a},null,8,["src","alt"])):/\.(?:webm|mp4)$/.test(a)?(d(),w("video",{key:1,src:`${U}/${a}`,controls:""},null,8,Ae)):(d(),w("span",Le,r(a),1))]))),128)),o(X,{modelValue:p.value,"onUpdate:modelValue":s[6]||(s[6]=a=>p.value=a),title:`${v.value?"修改":"发布"}响应`},{footer:t(()=>[l("span",Pe,[o(_,{onClick:s[5]||(s[5]=a=>p.value=!1)},{default:t(()=>[f("取消")]),_:1}),o(_,{type:"primary",onClick:M},{default:t(()=>[f(" 提交 ")]),_:1})])]),default:t(()=>[o(J,{model:n(u),class:"publish-form","label-width":"80px"},{default:t(()=>[o(A,{label:"描述"},{default:t(()=>[o(W,{modelValue:n(u).desc,"onUpdate:modelValue":s[3]||(s[3]=a=>n(u).desc=a),type:"textarea",autocomplete:"off"},null,8,["modelValue"])]),_:1}),v.value?N("",!0):(d(),b(A,{key:0,label:"文件列表"},{default:t(()=>[o(q,{"file-list":n(u).files,"onUpdate:fileList":s[4]||(s[4]=a=>n(u).files=a),class:"upload","auto-upload":!1,multiple:""},{trigger:t(()=>[o(_,{type:"primary"},{default:t(()=>[f("选择文件")]),_:1})]),tip:t(()=>[je]),_:1},8,["file-list"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const Ne=ve(Be,[["__scopeId","data-v-bb4e495a"]]);export{Ne as P};
