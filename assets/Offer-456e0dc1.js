import{d as W,u as X,r as y,E as C,q as O,i as Y,b as d,c as b,h as o,t as i,e as n,w as l,j as r,F as x,k as j,O as Z,x as ee,U as te,y as se,z as oe,S as _,A as ae,o as w,f as v,B as N,C as L,D as S,G as P,H as ne,J as le,K as ce,L as B,p as re,g as ie,M as de,N as ue,P as _e,_ as pe}from"./index-ce5a228c.js";const fe=h=>(re("data-v-753c7a7f"),h=h(),ie(),h),me={class:"main"},he={class:"article"},ge={class:"header"},be={class:"title"},we={class:"spans"},ve={class:"price"},ye={class:"time"},Ce={class:"ctime"},ke={class:"mtime"},xe={class:"expire"},Se={class:"desc"},Ie={class:"aside"},Ve=fe(()=>o("h3",{class:"aside-header"},"欢迎来列表",-1)),$e={class:"list"},Ae={class:"card-title"},Oe={class:"card-footer"},je={class:"dialog-footer"},Ne=W({__name:"Offer",props:{id:{type:[Number,String],required:!0}},setup(h){const I=X(),U=h,a=y(new Z);a.id=Number(U.id);const p=y([]);async function z(e,t){const s=await ee(e.id);s.user=new te,s.user.id=s.userId,delete s.userId,Object.assign(e,s);const u=await Promise.all(e.answerIds.map(m=>se(m)));t.push(...u.filter(D));for(const m of t)oe(m.user.id).then(k=>{m.user=k})}z(a,p).catch(e=>{C.error({showClose:!0,message:e.message}),console.error(e)});const V=O(()=>a.state===S.pending);function D({state:e}){return e===_.pending||e===_.accepted}async function E(e){const t=p[e];try{await de(t.id,a.id)}catch(s){C.error({showClose:!0,message:s.message}),console.error(s)}t.state=_.accepted}async function M(e){const t=p[e];try{await ue(t.id)}catch(s){C.error({showClose:!0,message:s.message}),console.error(s)}t.state=_.rejected,p.splice(e,1)}const g=Y(!1);let f=y($());const q=O(()=>{var e;return((e=a.user)==null?void 0:e.id)===I.getters.userId||a.state!==S.pending});function $(){const e=new ae;return e.userId=I.getters.userId,e.offerId=a.id,e}async function F(){g.value=!1;let e;try{e=await _e(f)}catch(s){return C.error({showClose:!0,message:s.message}),console.error(s)}const t=f;f=y($()),t.id=e,p.push(t)}return(e,t)=>{const s=d("el-tooltip"),u=d("el-button"),m=d("el-icon"),k=d("el-button-group"),G=d("el-text"),H=d("el-card"),J=d("el-input"),K=d("el-form-item"),R=d("el-form"),T=d("el-dialog");return w(),b(x,null,[o("main",me,[o("article",he,[o("header",ge,[o("h2",be,i(a.title),1),o("div",we,[n(s,{content:`类型：${r(N)[a.type]}`},{default:l(()=>[v(i(r(N)[a.type]),1)]),_:1},8,["content"]),n(s,{content:`状态：${r(P)[a.state]}`},{default:l(()=>[o("span",{class:L(["state",r(S)[a.state]])},i(r(P)[a.state]),3)]),_:1},8,["content"]),o("span",ve,i(a.price)+"元",1)]),n(u,{type:"primary",class:"publish-btn",disabled:q.value,onClick:t[0]||(t[0]=c=>g.value=!0)},{default:l(()=>[v(" 发布响应 ")]),_:1},8,["disabled"])]),o("div",ye,[o("span",Ce,"发布于"+i(a.ctime),1),o("span",ke,"修改于"+i(a.mtime),1),o("p",xe,"过期于"+i(a.expire),1)]),o("p",Se,i(a.desc),1),(w(!0),b(x,null,j(a.files,c=>(w(),b("p",{key:c},i(c),1))),128))]),o("aside",Ie,[Ve,o("ul",$e,[(w(!0),b(x,null,j(p,(c,A)=>(w(),b("li",{key:c.id,class:"answer-preview"},[n(H,{shadow:"hover"},{header:l(()=>[o("h4",Ae,i(c.user.nickname),1),n(k,{size:"small",onClick:t[1]||(t[1]=ne(()=>{},["stop"]))},{default:l(()=>[n(s,{content:"接受"},{default:l(()=>[n(u,{icon:r(le),onClick:Q=>E(A),disabled:!V.value||c.state===r(_).accepted},null,8,["icon","onClick","disabled"])]),_:2},1024),n(s,{content:"拒绝"},{default:l(()=>[n(u,{class:"reject-btn",onClick:Q=>M(A),disabled:!V.value||c.state===r(_).accepted},{default:l(()=>[n(m,{color:"red"},{default:l(()=>[n(r(ce))]),_:1})]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1024)]),footer:l(()=>[o("div",Oe,[o("span",null,i(c.ctime),1),n(s,{content:`状态：${r(B)[c.state]}`},{default:l(()=>[o("span",{class:L(["state",r(_)[c.state]])},i(r(B)[c.state]),3)]),_:2},1032,["content"])])]),default:l(()=>[n(G,{"line-clamp":2,class:"answer-desc"},{default:l(()=>[v(i(c.desc),1)]),_:2},1024)]),_:2},1024)]))),128))])])]),n(T,{modelValue:g.value,"onUpdate:modelValue":t[4]||(t[4]=c=>g.value=c),title:"发布响应"},{footer:l(()=>[o("span",je,[n(u,{onClick:t[3]||(t[3]=c=>g.value=!1)},{default:l(()=>[v("取消")]),_:1}),n(u,{type:"primary",onClick:F},{default:l(()=>[v(" 提交 ")]),_:1})])]),default:l(()=>[n(R,{model:r(f),class:"publish-form","label-width":"80px"},{default:l(()=>[n(K,{label:"描述"},{default:l(()=>[n(J,{modelValue:r(f).desc,"onUpdate:modelValue":t[2]||(t[2]=c=>r(f).desc=c),type:"textarea",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});const Pe=pe(Ne,[["__scopeId","data-v-753c7a7f"]]);export{Pe as default};
