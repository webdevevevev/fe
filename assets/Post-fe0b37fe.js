import{d as q,u as W,O as f,J as X,z as Y,D as Z,S as y,K as k,i as x,r as B,b as c,o as p,c as C,h as n,x as i,m as g,w as t,f as _,j as l,L as D,M as ee,e as a,A as se,N as te,P as ae,Q as oe,F as ne,l as le,H as re,R as ie,E as v,T as ce,U as de,B as ue,G as pe,_ as me}from"./index-ee28ec69.js";const be={class:"header"},fe={class:"title"},_e={class:"spans"},we={class:"price"},ye={class:"time"},ge={class:"ctime"},ve={class:"mtime"},he={class:"expire"},ke={class:"desc"},Ce={class:"dialog-footer"},Ve=q({__name:"Post",props:{base:{}},emits:["publish"],setup(N,{emit:P}){const o=N,U=P,h=W(),V=o.base instanceof f?X:Y,$=o.base instanceof f?Z:y,A=k(()=>o.base.state===y.accepted),w=k(()=>{var e;return((e=o.base.user)==null?void 0:e.id)===h.getters.userId}),d=x(!1);let m=B(o.base instanceof f?S():o.base);const z=k(()=>w.value||o.base.state!==$.pending);function S(){const e=new re;return e.userId=h.getters.userId,e.offerId=o.base.id,e.offer=new f,e.offer.id=e.offerId,e}function E(){return w?F(o.base):M()}function F(e){d.value=!1;try{return ie(e)}catch(s){return v.error({showClose:!0,message:s.message}),console.error(s)}}async function M(){d.value=!1;let e;try{e=await ce(m)}catch(u){return v.error({showClose:!0,message:u.message}),console.error(u)}const s=m;m=B(S()),s.id=e,s.user=new de,s.user.nickname=h.state.nickname,U("publish",s)}async function O(){const e=o.base;try{await ue(e.id)}catch(s){v.error({showClose:!0,message:s.message}),console.error(s)}e.state=y.accepted}async function R(){const e=o.base;try{await pe(e.id)}catch(s){v.error({showClose:!0,message:s.message}),console.error(s)}e.state=y.rejected}return(e,s)=>{var I,L,j;const u=c("el-tooltip"),b=c("el-button"),T=c("el-icon"),G=c("el-button-group"),H=c("el-input"),J=c("el-form-item"),K=c("el-form"),Q=c("el-dialog");return p(),C("article",null,[n("header",be,[n("h2",fe,i((I=e.base)==null?void 0:I.title),1),n("div",_e,[isFinite(e.base.type)?(p(),g(u,{key:0,content:`类型：${l(D)[e.base.type]}`},{default:t(()=>[_(i(l(D)[e.base.type]),1)]),_:1},8,["content"])):ee("",!0),a(u,{content:`状态：${l(V)[e.base.state]}`},{default:t(()=>[n("span",{class:se(["state",l($)[e.base.state]])},i(l(V)[e.base.state]),3)]),_:1},8,["content"]),n("span",we,i((L=e.base)==null?void 0:L.price)+"元",1)]),e.base instanceof l(f)?(p(),g(b,{key:0,type:"primary",class:"action-btn",disabled:z.value,onClick:s[0]||(s[0]=r=>d.value=!0)},{default:t(()=>[_(" 发布响应 ")]),_:1},8,["disabled"])):w.value?(p(),g(b,{key:1,type:"primary",class:"action-btn",onClick:s[1]||(s[1]=r=>d.value=!0)},{default:t(()=>[_(" 修改响应 ")]),_:1})):(p(),g(G,{key:2,size:"small",onClick:s[2]||(s[2]=oe(()=>{},["stop"])),class:"action-btn"},{default:t(()=>[a(u,{content:"接受"},{default:t(()=>[a(b,{icon:l(te),onClick:O,disabled:A.value},null,8,["icon","disabled"])]),_:1}),a(u,{content:"拒绝"},{default:t(()=>[a(b,{class:"reject-btn",onClick:R,disabled:A.value},{default:t(()=>[a(T,{color:"red"},{default:t(()=>[a(l(ae))]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1}))]),n("div",ye,[n("span",ge,"发布于"+i(e.base.ctime),1),n("span",ve,"修改于"+i(e.base.mtime),1),n("p",he,"过期于"+i((j=e.base)==null?void 0:j.expire),1)]),n("p",ke,i(e.base.desc),1),(p(!0),C(ne,null,le(e.base.files,r=>(p(),C("p",{key:r},i(r),1))),128)),a(Q,{modelValue:d.value,"onUpdate:modelValue":s[5]||(s[5]=r=>d.value=r),title:`${w.value?"修改":"发布"}响应`},{footer:t(()=>[n("span",Ce,[a(b,{onClick:s[4]||(s[4]=r=>d.value=!1)},{default:t(()=>[_("取消")]),_:1}),a(b,{type:"primary",onClick:E},{default:t(()=>[_(" 提交 ")]),_:1})])]),default:t(()=>[a(K,{model:l(m),class:"publish-form","label-width":"80px"},{default:t(()=>[a(J,{label:"描述"},{default:t(()=>[a(H,{modelValue:l(m).desc,"onUpdate:modelValue":s[3]||(s[3]=r=>l(m).desc=r),type:"textarea",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const Ae=me(Ve,[["__scopeId","data-v-d7d64897"]]);export{Ae as P};
