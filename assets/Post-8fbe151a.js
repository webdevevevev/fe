import{d as W,u as X,O as m,J as Y,z as Z,D as x,S as k,K as C,i as ee,r as D,b as d,o as c,l as w,h as l,x as r,c as y,w as t,f as b,j as n,L as N,M as se,e as o,A as te,N as ae,P as oe,Q as ne,F as le,m as ie,H as de,R as ce,T as re,U as ue,B as pe,G as _e,p as be,g as fe,_ as me}from"./index-f000c5d8.js";const we=f=>(be("data-v-432ad9dd"),f=f(),fe(),f),ye={class:"header"},ve={class:"title"},ge={class:"spans"},ke={class:"price"},he={class:"time"},Ce={class:"ctime"},$e={class:"mtime"},Se={class:"expire"},Ve={class:"desc"},Ie=["src"],Ae={key:2},Le=we(()=>l("div",{class:"el-upload__tip"}," 支持上传图片和视频 ",-1)),je={class:"dialog-footer"},Be=W({__name:"Post",props:{base:{}},emits:["publish"],setup(f,{emit:P}){const i=f,U=P,h=X(),$=i.base instanceof m?Y:Z,S=i.base instanceof m?x:k,V=C(()=>i.base.state===k.accepted),v=C(()=>{var e;return((e=i.base.user)==null?void 0:e.id)===h.getters.userId}),p=ee(!1);let u=D(i.base instanceof m?I():i.base);const z=C(()=>v.value||i.base.state!==S.pending);function I(){const e=new de;return e.userId=h.getters.userId,e.user.id=e.userId,e.offerId=i.base.id,e.offer=new m,e.offer.id=e.offerId,e}function F(){return v?O(i.base):M()}function O(e){return p.value=!1,ce(e)}async function M(){p.value=!1;const e=await re(u),s=u;u=D(I()),s.id=e,s.user=new ue,s.user.nickname=h.state.nickname,U("publish",s)}async function R(){const e=i.base;await pe(e.id),e.state=k.accepted}async function T(){const e=i.base;await _e(e.id),e.state=k.rejected}return(e,s)=>{var L,j,B;const g=d("el-tooltip"),_=d("el-button"),E=d("el-icon"),G=d("el-button-group"),H=d("el-image"),J=d("el-input"),A=d("el-form-item"),K=d("el-upload"),Q=d("el-form"),q=d("el-dialog");return c(),w("article",null,[l("header",ye,[l("h2",ve,r((L=e.base)==null?void 0:L.title),1),l("div",ge,[isFinite(e.base.type)?(c(),y(g,{key:0,content:`类型：${n(N)[e.base.type]}`},{default:t(()=>[b(r(n(N)[e.base.type]),1)]),_:1},8,["content"])):se("",!0),o(g,{content:`状态：${n($)[e.base.state]}`},{default:t(()=>[l("span",{class:te(["state",n(S)[e.base.state]])},r(n($)[e.base.state]),3)]),_:1},8,["content"]),l("span",ke,r((j=e.base)==null?void 0:j.price)+"元",1)]),e.base instanceof n(m)?(c(),y(_,{key:0,type:"primary",class:"action-btn",disabled:z.value,onClick:s[0]||(s[0]=a=>p.value=!0)},{default:t(()=>[b(" 发布响应 ")]),_:1},8,["disabled"])):v.value?(c(),y(_,{key:1,type:"primary",class:"action-btn",onClick:s[1]||(s[1]=a=>p.value=!0)},{default:t(()=>[b(" 修改响应 ")]),_:1})):(c(),y(G,{key:2,size:"small",onClick:s[2]||(s[2]=ne(()=>{},["stop"])),class:"action-btn"},{default:t(()=>[o(g,{content:"接受"},{default:t(()=>[o(_,{icon:n(ae),onClick:R,disabled:V.value},null,8,["icon","disabled"])]),_:1}),o(g,{content:"拒绝"},{default:t(()=>[o(_,{class:"reject-btn",onClick:T,disabled:V.value},{default:t(()=>[o(E,{color:"red"},{default:t(()=>[o(n(oe))]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1}))]),l("div",he,[l("span",Ce,"发布于"+r(e.base.ctime),1),l("span",$e,"修改于"+r(e.base.mtime),1),l("p",Se,"过期于"+r((B=e.base)==null?void 0:B.expire),1)]),l("p",Ve,r(e.base.desc),1),(c(!0),w(le,null,ie(e.base.files,a=>(c(),w("p",{key:a},[/\.(?:(?:pn|jpe?)g|webp)$/.test(a)?(c(),y(H,{key:0,src:a,alt:a},null,8,["src","alt"])):/\.(?:webm|mp4)$/.test(a)?(c(),w("video",{key:1,src:a,controls:""},null,8,Ie)):(c(),w("span",Ae,r(a),1))]))),128)),o(q,{modelValue:p.value,"onUpdate:modelValue":s[6]||(s[6]=a=>p.value=a),title:`${v.value?"修改":"发布"}响应`},{footer:t(()=>[l("span",je,[o(_,{onClick:s[5]||(s[5]=a=>p.value=!1)},{default:t(()=>[b("取消")]),_:1}),o(_,{type:"primary",onClick:F},{default:t(()=>[b(" 提交 ")]),_:1})])]),default:t(()=>[o(Q,{model:n(u),class:"publish-form","label-width":"80px"},{default:t(()=>[o(A,{label:"描述"},{default:t(()=>[o(J,{modelValue:n(u).desc,"onUpdate:modelValue":s[3]||(s[3]=a=>n(u).desc=a),type:"textarea",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(A,{label:"文件列表"},{default:t(()=>[o(K,{"file-list":n(u).files,"onUpdate:fileList":s[4]||(s[4]=a=>n(u).files=a),class:"upload","auto-upload":!1,multiple:""},{trigger:t(()=>[o(_,{type:"primary"},{default:t(()=>[b("选择文件")]),_:1})]),tip:t(()=>[Le]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const Ne=me(Be,[["__scopeId","data-v-432ad9dd"]]);export{Ne as P};
